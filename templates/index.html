<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Visionary AI Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #0f172a; color: white; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; }
        .banner-warning { background: #f59e0b; color: black; }
        .banner-danger { background: #ef4444; color: white; }
        #chat-box { height: 400px; overflow-y: auto; background: #1e293b; border-radius: 10px; padding: 15px; }
        .user-msg { color: #3b82f6; text-align: right; margin-bottom: 10px; }
        .ai-msg { color: #10b981; margin-bottom: 10px; border-left: 2px solid #10b981; padding-left: 10px; }
    </style>
</head>
<body>

{% if banner %}
<div class="alert {{ banner[1] }} text-center m-0">{{ banner[0] }}</div>
{% endif %}

<div class="container py-5">
    {% if login_mode %}
    <div class="row justify-content-center">
        <div class="col-md-4 glass text-center">
            <h3 class="mb-4">Visionary AI</h3>
            <form action="/login" method="post">
                <input type="email" name="email" class="form-control bg-dark text-white border-secondary mb-3" placeholder="Email" required>
                <button class="btn btn-primary w-100">Entrar</button>
            </form>
        </div>
    </div>
    {% else %}
    <div class="row g-4">
        <div class="col-md-4">
            <div class="glass mb-4">
                <h5>Créditos: {{ creditos }} / 10</h5>
                <div class="progress"><div class="progress-bar" style="width: {{ creditos*10 }}%"></div></div>
                <small class="text-muted mt-2 d-block">Usuario: {{ user }}</small>
            </div>
            <div class="glass">
                <input type="file" id="file" class="form-control bg-dark text-white mb-3">
                <button onclick="subir()" class="btn btn-primary w-100">Cargar Datos</button>
                <div id="status" class="mt-2 small text-center"></div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="glass mb-3 text-center" id="panel"><h6 id="ctx">Sube un archivo para detectar industria</h6></div>
            <div class="glass">
                <div id="chat-box" class="mb-3"></div>
                <div class="input-group">
                    <input type="text" id="msg" class="form-control bg-dark text-white" placeholder="Pregunta algo...">
                    <button onclick="enviar()" class="btn btn-primary">Enviar</button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
    function subir() {
        let f = document.getElementById('file').files[0];
        let d = new FormData(); d.append('file', f);
        fetch('/upload', {method:'POST', body:d}).then(r=>r.json()).then(data=>{
            document.getElementById('ctx').innerText = "Industria: " + data.contexto;
            document.getElementById('status').innerText = "✅ Listo";
        });
    }
    function enviar() {
        let m = document.getElementById('msg').value;
        let box = document.getElementById('chat-box');
        box.innerHTML += `<div class="user-msg">${m}</div>`;
        fetch('/chat', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({message:m})})
        .then(r=>r.json()).then(data=>{
            box.innerHTML += `<div class="ai-msg">${data.reply}</div>`;
            document.getElementById('msg').value = "";
        });
    }
</script>
</body>
</html>